#!/usr/bin/env bash
set -euo pipefail

# Managed by Ansible (role: certbot)
# Called by certbot after a successful certificate issue/renewal.

{% set services = (_certbot_deploy_hook_services | default([])) %}
{% if services | length == 0 %}
exit 0
{% endif %}

for svc in {{ services | to_json }}; do
  if systemctl list-unit-files | awk '{print $1}' | grep -qx "${svc}.service"; then
    systemctl try-restart "${svc}.service" >/dev/null 2>&1 || true
  else
    systemctl try-restart "${svc}" >/dev/null 2>&1 || true
  fi
done
